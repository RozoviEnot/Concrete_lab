<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Лабораторный калькулятор «глинистого» бетона</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{
    --bg:#1e1e1e; --side:#252526; --field:#2d2d30; --btn:#0e639c;
    --text:#cccccc; --accent:#4ec9b0; --border:#3e3e42;
  }
  *{box-sizing:border-box;font-family:Segoe UI,Arial,Helvetica,sans-serif}
  body{margin:0;background:var(--bg);color:var(--text);display:flex;flex-direction:column;height:100vh}
  h3{margin:8px 0 4px;font-size:13px;text-transform:uppercase;letter-spacing:.5px;color:#969696}
  .row{display:flex;align-items:center;margin:3px 0}
  .row label{width:110px;font-size:12px}
  .row input{width:90px;background:var(--field);color:var(--text);border:1px solid var(--border);padding:4px 6px;border-radius:3px}
  button{background:var(--btn);color:#fff;border:none;padding:6px 12px;border-radius:3px;cursor:pointer;font-size:12px;margin:4px 4px 4px 0}
  button:hover{opacity:.9}
  select{background:var(--field);color:var(--text);border:1px solid var(--border);padding:4px;border-radius:3px;font-size:12px;margin-right:4px}

  /* desktop */
  #wrap{display:flex;flex:1;min-height:0}
  #left{width:280px;background:var(--side);padding:12px;overflow:auto}
  #right{flex:1;padding:12px;display:flex;flex-direction:column;min-height:0}
  #result{flex:1;background:var(--field);border:1px solid var(--border);padding:10px;font-family:Consolas,monospace;font-size:12px;white-space:pre;line-height:1.4;overflow:auto}
  #total{background:var(--side);padding:8px 12px;font-weight:bold;font-size:13px}

  /* mobile */
  @media(max-width:600px){
    #wrap{flex-direction:column}
    #left{width:100%;height:auto}
    #right{width:100%;padding-top:0}
  }
</style>
<base target="_blank">
</head>
<body>

<div id="wrap">
  <div id="left">
    <h3>Ингредиенты (кг на 1 кг цемента)</h3>
    <div id="inputs"></div>

    <h3>Масса цемента</h3>
    <div class="row">
      <label>Цемент, кг:</label>
      <input id="cement" type="number" value="1" step="0.1" min="0.1">
    </div>

    <div class="btns">
      <button onclick="resetDefault()">Сброс</button>
      <button onclick="savePreset()">Сохранить</button>
    </div>
    <div class="btns">
      <select id="presetSelect"></select>
      <button onclick="loadPreset()">Загрузить</button>
      <button onclick="delPreset()">Удалить</button>
    </div>
  </div>

  <div id="right">
    <div id="result"></div>
    <div id="total"></div>
  </div>
</div>

<script>
const defaultRatios = {
  "Цемент":1.000,"Песок 0-1 мм":1.200,"Каолин":0.250,"Гашёная известь":0.030,
  "Метилцеллюлоза":0.002,"КМЦ / тилоза":0.001,"ПВА-клей сухой":0.010,
  "Кальц. тальк/мука":0.150,"Вода":0.440,"Пластификатор":0.004,"ПП-волокно 6 мм":0.003
};
let ratios = {...defaultRatios};

function buildInputs(){
  const box = document.getElementById('inputs');
  box.innerHTML = '';
  for(let key in ratios){
    const row = document.createElement('div'); row.className = 'row';
    row.innerHTML = `<label>${key}:</label>
                     <input data-key="${key}" type="number" step="0.0001" value="${ratios[key]}">`;
    box.appendChild(row);
  }
  box.querySelectorAll('input').forEach(inp=>{
    inp.addEventListener('input', e=>{
      ratios[e.target.dataset.key] = parseFloat(e.target.value)||0;
      calc();
    });
  });
}
function calc(){
  const cement = parseFloat(document.getElementById('cement').value)||1;
  let out = `Рецепт на ${cement.toFixed(2)} кг цемента   (В/Ц = ${ratios['Вода'].toFixed(3)})\n`;
  out += '------------------------------------------------\n';
  let total = 0;
  for(let key in ratios){
    let w = ratios[key]*cement;
    total += w;
    out += `${key.padEnd(22)} ${w.toFixed(4)} кг\n`;
  }
  out += '------------------------------------------------';  
  document.getElementById('result').textContent = out;
  document.getElementById('total').textContent = `Итого масса смеси ≈ ${total.toFixed(3)} кг`;
}
function resetDefault(){ratios={...defaultRatios};buildInputs();calc();}
function savePreset(){
  const name = prompt('Имя пресета:'); if(!name||!name.trim())return;
  localStorage.setItem('preset_'+name, JSON.stringify(ratios));
  updateList();
}
function loadPreset(){
  const sel = document.getElementById('presetSelect');
  if(!sel.value)return;
  ratios = JSON.parse(localStorage.getItem('preset_'+sel.value));
  buildInputs(); calc();
}
function delPreset(){
  const sel = document.getElementById('presetSelect');
  if(!sel.value)return;
  if(confirm('Удалить '+sel.value+'?')){localStorage.removeItem(sel.value);updateList();}
}
function updateList(){
  const sel = document.getElementById('presetSelect'); sel.innerHTML='';
  for(let i=0;i<localStorage.length;i++){
    const k = localStorage.key(i);
    if(k.startsWith('preset_')){
      const name = k.replace('preset_','');
      sel.innerHTML += `<option value="${k}">${name}</option>`;
    }
  }
}
// старт
buildInputs();
calc();
updateList();
document.getElementById('cement').addEventListener('input', calc);
</script>

</body>
</html>
